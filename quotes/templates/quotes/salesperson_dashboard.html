{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QMS | Salesperson Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: "Poppins", sans-serif;
            background: #0d1326;
            color: white;
        }

        /* NAVBAR */
        .navbar {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-title {
            font-size: 22px;
            font-weight: 600;
            color: #ffd700;
        }

        .profile-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-area img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ffd700;
        }

        /* LAYOUT */
        .layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            height: calc(100vh - 70px);
        }

        /* SIDEBAR */
        .sidebar {
            background: #0a1020;
            padding: 25px 18px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar h2 {
            text-align: center;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .side-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: 0.3s;
        }

        .side-link:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }

        /* MAIN */
        .main-content {
            padding: 30px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 15px;
        }

        /* CARDS */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .card {
            background: rgba(255, 255, 255, 0.06);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            text-align: center;
            transition: 0.3s;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
        }

        .card h3 {
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 8px;
        }

        .card p {
            font-size: 32px;
            font-weight: 700;
        }

        /* TABLE */
         table {
                width: 100%;
                border-collapse: collapse;
                table-layout: fixed;   /* ‚≠ê IMPORTANT */
                }

        th, td {
                padding: 16px;
                text-align: center;
                vertical-align: middle;
                white-space: nowrap;      /* prevents jumping */
                }

            th {
            background: rgba(255,255,255,0.15);
            color: #ffd700;
            font-weight: 600;
            }

            td {
            background: rgba(255,255,255,0.08);
            color: #ffffff;
            }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="navbar-title">QMS ‚Äî Salesperson Dashboard</div>
    <div class="profile-area">
        <img src="{% static 'quotes/user.png' %}">
        <span>{{ request.user.username }}</span>
        <a href="{% url 'logout' %}" style="color:#ffd700;">Logout</a>
    </div>
</div>

<!-- LAYOUT -->
<div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2>Menu</h2>
        <a class="side-link" href="#"><i class="ri-dashboard-line"></i> Dashboard</a>
        <a class="side-link" href="{% url 'create_quotation' %}"><i class="ri-file-add-line"></i> Create Quotation</a>
        <a class="side-link" href="{% url 'my_quotations' %}"><i class="ri-file-list-2-line"></i> My Quotations</a>
        <a class="side-link" href="{% url 'client_management' %}"><i class="ri-user-3-line"></i> My Clients</a>
        <a class="side-link" href="{% url 'product_list' %}"><i class="ri-archive-line"></i> Products (View Only)</a>
    </div>

    <!-- MAIN -->
    <div class="main-content">

        <!-- KPI SECTION -->
        <h2 class="section-title">üìä Sales Overview (2025)</h2>

        <div class="card-grid">
            <div class="card">
                <h3>Total Quotations</h3>
                <p>{{ total_quotations }}</p>
            </div>
            <div class="card">
                <h3>Sent Quotations</h3>
                <p>{{ sent_quotations }}</p>
            </div>
            <div class="card">
                <h3>Approved Quotations</h3>
                <p>{{ approved_quotations }}</p>
            </div>
        </div>

        <!-- CHARTS -->
        <h2 class="section-title">üìà Performance Analytics</h2>

        <div class="card-grid">
            <div class="card" style="grid-column: span 2;">
                <h3>Monthly Quotations Trend</h3>
                <canvas id="quotationTrend"></canvas>
            </div>

            <div class="card">
                <h3>Quotation Status</h3>
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- TABLE -->
        <h2 class="section-title">üìù Recent Quotations</h2>

        <table>
            <thead>
                <tr>
                    <th>Client</th>
                    <th>ID</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for q in recent_quotations %}
                <tr>
                <td>
                    {% if q.client %}
                    {{ q.client.contact_person }}
                    {% else %}
                    <span class="muted-text">‚Äî</span>
                    {% endif %}
                </td>
                <td>{{ q.id }}</td>
                <td>{{ q.status }}</td>
                <td>{{ q.date_created|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4">No recent quotations</td></tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>

<!-- CHART JS -->
<script>
new Chart(document.getElementById('quotationTrend'), {
    type: 'line',
    data: {
        labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
        datasets: [{
            data: {{ monthly_data|safe }},
            borderWidth: 2,
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
        labels: ['Approved','Sent','Draft'],
        datasets: [{
            data: {{ status_data|safe }}
        }]
    },
    options: {
        plugins: { legend: { position: 'bottom' } }
    }
});
</script>

</body>
</html>
